<!DOCTYPE html>
<html>
<head>
  <title>ГРА «ЗНАЙДИ ШКІЛЬНУ СВОЮ ФІНАНСОВУ АВТОНОМІЮ</title>
  <link rel="stylesheet/less" href="./style.less"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
<div id='app' class="board">

  <div class="slides">
    <div v-if="numberSlides<6 || (numberSlide > 7 && this.numberSlide < 11)" class="next" @click="changeSlide">
      Далі =>
    </div>
    <div v-if="numberSlides===0" class="slide-0">

    </div>
    <div v-if="numberSlides===1" class="slide-1">
    </div>

    <div v-if="numberSlides===2" class="slide-2">
    </div>

    <div v-if="numberSlides===3" class="slide-3">
    </div>
    <div v-if="numberSlides===4" class="slide-4">
    </div>

    <div v-if="numberSlides===5" class="slide-5">
      <!--      <img src="images/exit.png" @click="changeSlide" class="exit" title="Натисніть, щоб пройти далі"></img>-->
    </div>

    <div v-if="numberSlides===6" class="slide-6">
      <div class="task"> Завдання: складіть пазл (оберіть пазли, які потрібно поміняти місцями)</div>
      <div class="skrynya">
        <div @click="selectImage" id="skrynya2" class="skrynya1 top-right"></div>
        <div @click="selectImage" id="skrynya3" class="skrynya3 bottom-right"></div>
        <div @click="selectImage" id="skrynya1" class="skrynya4 top-left"></div>
        <div @click="selectImage" id="skrynya4" class="skrynya2 bottom-left"></div>
      </div>
    </div>
    <div v-if="numberSlides===7" class="slide-7">

      <div class="task"> Завдання: візьміть ключ, відімкніть замок</div>
      <div v-if="controlSlide" class="outside hidden">
        <div class="task">Зараз потрібно буде пройти смугу перешкод</div>
        <div class="next" @click="changeSlide">
          Далі =>
        </div>
      </div>
      <div class="door-lock">
        <div class="doors">
          <div class="door door-left"></div>
          <div class="door door-right"></div>
        </div>

        <img src="images/lock.png" @click="selectLock('lock')" class="lock"></div>
    </div>
    <div v-if="numberSlides===8" class="slide-8">
      <img src="images/rock.png" class="blocking" alt="скеля гора">
      <div class="test-block">
        <div v-for="q,qIndex in questions.s10" :key="q.question" class="test">
          {{q.question}}
          <div v-for="ans,aIndex in q.allAnswers"
               :key="ans.title"
               :title="ans.title">
            <label>
              <input type="checkbox"
                     :value="ans.value"
                     @change="controlAnswer('s10')"
                     v-model="answers.s10[qIndex]">{{ans.title}}
            </label>
          </div>
        </div>
      </div>
    </div>
    <div v-if="numberSlides===9" class="slide-9">
      <div class="blocking">
        <img src="images/fire.png" alt="вогонь">
      </div>
      <div class="test-block">
        <div class="admin-school">
          <img v-if="howFoundKeys===1" src="images/fire.gif" alt="вогонь анімація" height="50px">
          <h1 class="text-fire">АДМІНІСТРАЦІЯ ШКОЛИ</h1>
          <img v-if="howFoundKeys===1" src="images/fire.gif" alt="вогонь анімація" height="50px">
        </div>
        <div v-for="q,qIndex in questions.s11" :key="q.question" class="test">
          {{q.question}}
          <div v-for="ans,aIndex in q.allAnswers"
               :key="ans.title"
               :title="ans.title">
            <label>
              <input type="checkbox"
                     :value="ans.value"
                     @change="controlAnswer('s11')"
                     v-model="answers.s11[qIndex]">{{ans.title}}
            </label>
          </div>
        </div>
      </div>
    </div>

    <div v-if="numberSlides===10" class="slide-10">
      <img src="images/pipes.png" alt="труби" class="blocking">
      <div class="test-block">
        <div class="task">ГРОШІ</div>
        <div v-for="q,qIndex in questions.s12" :key="q.qIndex" class="test">
          {{q.question}}
          <div v-for="ans,aIndex in q.allAnswers"
               :key="ans.title"
               :title="ans.title">
            <label>
              <input type="checkbox" :value="ans.value" @change="controlAnswer('s12')"
                     v-model="answers.s12[qIndex]">{{ans.title}}
            </label>
          </div>
        </div>
      </div>
    </div>

    <div v-if="numberSlides===11" class="slide-11">
      <h1 class="task">Відкрийте скриню: відімкніть ключами замки </h1>
      <div class="box-all">
        <img src="images/sunduk.png" alt="скриня" style="width: 800px; height: 600px;">
        <div class="box">
          <div>
            <img src="images/lock.png" alt="замок" @click="selectLock('lock1')" class="lock1">
          </div>
          <div>
            <img src="images/lock.png" alt="замок" @click="selectLock('lock2')" class="lock2">
          </div>
          <div>
            <img src="images/lock.png" alt="замок" @click="selectLock('lock3')" class="lock3">
          </div>
        </div>
      </div>
    </div>

    <div v-if="numberSlides>11" id="gifts" class="fadeIn">
    </div>
    <div class="overlay hidden">
    </div>
  </div>


  <div v-if="numberSlides<12" class="keys">
    <div class="key hidden" @click="giveKey" id="key1"></div>
    <div class="key hidden" @click="giveKey" id="key2"></div>
    <div class="key hidden" @click="giveKey" id="key3"></div>
  </div>
</div>

<script src="js/keys.js"></script>
<script>

  const questions = {
    s10: [
      {
        question: "1. Хто такий засновник школи?",
        correctAnswers: [3],
        allAnswers: [
          {
            title: 'директор школи',
            value: 1
          },
          {
            title: 'батьківський комітет',
            value: 2
          },
          {
            title: 'місцева рада депутатів',
            value: 3
          },
          {
            title: 'управління / відділ освіти',
            value: 4
          }
        ]
      },
      {
        question: "2. Які документи має ухвалити засновник?",
        correctAnswers: [1, 2],
        allAnswers: [
          {
            title: 'рішення про переведення шкіл на фінансову автономію',
            value: 1
          },
          {
            title: 'положення про утворення, організацію діяльності та ліквідацію Піклувальних ' +
              '(Наглядових) рад середніх навчальних закладів комунальної форми власності',
            value: 2
          },
          {
            title: 'рішення про ведення окремої бухгалтерії у школах',
            value: 3
          },
          {
            title: 'рішення про створення комунального підприємства «Піклувальна (Наглядова) рада»',
            value: 4
          }
        ]
      },
    ],
    s11: [
      {
        question: "1. Чи допоможе фінансова автономія залучити кошти із різних джерел?",
        correctAnswers: [1],
        allAnswers: [
          {
            title: 'так',
            value: 1
          },
          {
            title: 'ні',
            value: 2
          },
          {
            title: 'не знаю',
            value: 3
          },
        ]
      },
      {
        question: "2. Що робити, щоб фінансова автономія запрацювала?",
        correctAnswers: [1, 2, 3, 4],
        allAnswers: [
          {
            title: 'сформувати стратегію розвитку школи на 3-5 років',
            value: 1
          },
          {
            title: 'провести конкурс до піклувальних (наглядових) рад',
            value: 2
          },
          {
            title: 'налагодити спілкування із громадою',
            value: 3
          },
          {
            title: 'розказувати про діяльність школи',
            value: 4
          },
        ]
      },
      {
        question: "3. Яка роль піклувальної (наглядової) ради школи?",
        correctAnswers: [1, 2, 3],
        allAnswers: [
          {
            title: 'допомагати школі писати стратегію розвитку',
            value: 1
          },
          {
            title: 'допомагати залучати ресурси',
            value: 2
          },
          {
            title: 'контролювати діяльність адміністрації школи',
            value: 3
          }
        ]
      },
    ],
    s12: [
      {
        question: "1. Де взяти гроші?",
        correctAnswers: [1, 2, 3, 4, 5, 6, 7, 8, 9],
        allAnswers: [
          {
            title: 'державний бюджет',
            value: 1
          },
          {
            title: 'місцевий бюджет',
            value: 2
          },
          {
            title: 'гранти вітчизняних і міжнародних організацій',
            value: 3
          },
          {
            title: 'плата за надання навчальних та інших послуг',
            value: 4
          },
          {
            title: 'плата за науково-дослідні роботи',
            value: 5
          },
          {
            title: 'доходи від реалізації продукції',
            value: 6
          },
          {
            title: 'дивіденди від цінних паперів',
            value: 7
          },
          {
            title: 'добровільні внески',
            value: 8
          },
          {
            title: 'інші джерела, не заборонені законодавством',
            value: 9
          }
        ]
      },
      {
        question: "2. Хто допоможе залучити фінансування?",
        correctAnswers: [1],
        allAnswers: [
          {
            title: 'піклувальна (наглядова) рада',
            value: 1
          },
          {
            title: 'батьки',
            value: 2
          },
          {
            title: 'батьківські комітети',
            value: 3
          },
          {
            title: 'управління освіти',
            value: 4
          },
          {
            title: 'депутати місцевих рад',
            value: 5
          }
        ]
      },
    ],
  };

  let t = new Vue({
    el: '#app',
    data() {
      return {
        controlSlide: false,
        currentKey: 0,
        usedKey: false,
        numberSelect: 0,
        arrayImages: [],
        numberSlide: 0,
        foundkeys: 0,
        answers: {
          s10: {
            0: [], 1: []
          },
          s11: {
            0: [], 1: [], 2: []
          },
          s12: {
            0: [], 1: []
          }
        },
        questions,
      }
    },
    computed: {
      howFoundKeys() {
        return this.foundkeys;
      },
      numberSlides() {
        return this.numberSlide;
      }
    },
    methods: {
      changeSlide() {
        if (this.numberSlide < 6 || (this.controlSlide)) {
          const tempSlide = document.querySelector(".slide-" + this.numberSlide);
          tempSlide.classList.add('hidden-slide');
          const overlay = document.querySelector(".overlay");
          overlay.classList.remove('hidden');
          this.controlSlide = false;
          setTimeout(() => {
            this.numberSlide++;
            overlay.classList.add('hidden');
          }, 1000);
          const overlay2 = document.querySelector(".overlay");
          overlay2.classList.remove('hidden');
          setTimeout(() => overlay2.classList.add('hidden'), 1000);
        } else {
          if (this.numberSlide > 7 && this.numberSlide < 11) {
            alert("Ви вказали не всі правильні відповіді");
          }
        }
      },

      selectImage(e) {
        this.numberSelect++;
        this.arrayImages.push(e.target.id);
        e.target.classList.add('selected');
        if (this.numberSelect === 2) {
          setTimeout(() => {
            this.changeImages();
          }, 400);
          this.numberSelect = 0;
        }
      },
      changeImages() {
        let el1 = document.getElementById(this.arrayImages[0]);
        let el2 = document.getElementById(this.arrayImages[1]);
        let temp = [...el1.classList].find(e => e.startsWith('skrynya'));
        let temp2 = [...el2.classList].find(e => e.startsWith('skrynya'));
        el1.classList.replace(temp, temp2);
        el2.classList.replace(temp2, temp);
        el1.classList.remove('selected');
        el2.classList.remove('selected');
        this.arrayImages = [];
        this.controlSkryni();
      },
      controlSkryni() {
        this.controlSlide = true;
        for (let i = 1; i < 4; i++) {
          let id = "skrynya" + i;
          let el = document.getElementById(id);
          if (!el.className.includes(id)) {
            this.controlSlide = false;
          }
        }
        if (this.controlSlide) {
          this.foundkeys = 1;
          this.visibleKeys();
          setTimeout(() => {
            alert("Вітаємо! Ви знайшли ключ!");
            this.changeSlide();
          }, 2000);
        }
      },
      giveKey(e) {
        e.target.classList.add("selected-key");
        if (this.foundkeys < 1) {
          alert("Ключів немає");
          return;
        }
        if (!this.usedKey) {
          this.usedKey = true;
        }
      },
      selectLock(nameLock) {
        console.log("select ");
        if (this.usedKey) {
          this.openLock(nameLock);
          if (this.numberSlide === 7) {
            setTimeout(() => {
              let selectedLock = document.getElementsByClassName(nameLock);
              selectedLock[0].classList.add('hidden-lock');
              let selectedKey = document.getElementsByClassName("selected-key");
              selectedKey[0].classList.replace("selected-key", "hidden");
              this.openDoor();
              setTimeout(() => {
                let outside = document.getElementsByClassName('outside');
                outside[0].classList.remove('hidden');
              }, 2000);
            }, 500);
            this.controlSlide = true;
          }
          this.foundkeys--;
          this.usedKey = false;
          if (this.numberSlide === 11 && this.foundkeys === 0) {
            this.numberSlide = 12;
          }
        } else {
          alert("Спочатку візьміть ключ");
        }
      },
      openDoor() {
        let temp1 = document.getElementsByClassName("door");
        for (let i = 0; i < temp1.length; i++) {
          temp1[i].classList.add("open");
        }
      },
      openLock(nameLock) {
        let lock = document.getElementsByClassName(nameLock);
        let selectedKey = document.getElementsByClassName('selected-key');
        for (let i = 0; i < selectedKey.length; i++) {
          if (!selectedKey[i].classList.contains('hidden')) {
            selectedKey[i].classList.add('hidden');
          }
        }
        lock[0].src = "images/lock_key.png";
      },
      controlAnswer(slideNumber) {
        this.controlSlide = true;
        for (let k = 0; k < questions[slideNumber].length; k++) {
          let arr2 = questions[slideNumber][k].correctAnswers;
          let arr1 = this.answers[slideNumber][k];
          if (JSON.stringify(arr1.sort()) !== JSON.stringify(arr2.sort())) {
            this.controlSlide = false;
          }
        }
        if (this.controlSlide) {
          this.foundkeys++;
          this.visibleKeys();
          let blocking = document.getElementsByClassName("blocking");
          blocking[0].classList.add("blocking-out");
          if (this.numberSlide === 9) {
            let text = document.querySelector(".text-fire");
            text.classList.replace("text-fire", "text-without-fire");
            let blockText = document.getElementsByClassName("admin-school");
            blockText[0].classList.replace("admin-school", "admin-school-without-fire");
          }
          setTimeout(() => {
            alert("Вітаємо! Ви знайшли ключ! Можна йти далі.");
            this.changeSlide();
          }, 100);
        }
      },
      visibleKeys() {
        let keys = document.getElementsByClassName("key");
        keys[this.foundkeys - 1].classList.remove('hidden');
      }
    }
  })

</script>
</body>
</html>

